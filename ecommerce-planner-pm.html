<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電商增長規劃師 - 從數據到行動的完整解決方案</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-900: #111827;
        }
        
        body { 
            font-family: 'Inter', 'Noto Sans TC', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .step-container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 2rem 1rem;
        }
        
        .step-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-100);
        }
        
        .step-number {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
            margin-right: 1rem;
        }
        
        .step-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin: 0;
        }
        
        .step-subtitle {
            color: #6b7280;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .progress-bar {
            height: 8px;
            background: var(--gray-100);
            border-radius: 4px;
            overflow: hidden;
            margin: 2rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            transition: width 0.5s ease;
        }
        
        .input-group {
            margin-bottom: 1.5rem;
        }
        
        .input-label {
            display: block;
            font-weight: 500;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .input-field {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-100);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.2s ease;
            background: white;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: var(--gray-900);
            border: 2px solid var(--gray-100);
        }
        
        .btn-secondary:hover {
            background: var(--gray-50);
        }
        
        .metric-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-100);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .insight-card {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #0ea5e9;
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .campaign-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            border: 2px solid var(--gray-100);
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .campaign-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .campaign-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
        }
        
        .hidden { display: none !important; }
        
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .step-card { padding: 1.5rem; }
        }
        
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: white;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border-left: 4px solid var(--success);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .toast.show { transform: translateX(0); }
        
        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spin 0.75s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="step-container">
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div id="progress" class="progress-fill" style="width: 20%"></div>
        </div>
        
        <!-- Step 1: 業務現況分析 -->
        <div id="step-1" class="step-card">
            <div class="step-header">
                <div class="step-number">1</div>
                <div>
                    <h2 class="step-title">業務現況分析</h2>
                    <p class="step-subtitle">了解您的品牌現況，建立數據基礎</p>
                </div>
            </div>
            
            <div class="grid-2">
                <div class="input-group">
                    <label class="input-label">品牌名稱</label>
                    <input type="text" id="brand-name" class="input-field" placeholder="例如：勤億蛋品">
                </div>
                <div class="input-group">
                    <label class="input-label">主要商品類別</label>
                    <select id="category" class="input-field">
                        <option>食品飲料</option>
                        <option>美妝保養</option>
                        <option>服飾配件</option>
                        <option>3C電子</option>
                        <option>居家生活</option>
                        <option>其他</option>
                    </select>
                </div>
            </div>
            
            <div class="input-group">
                <label class="input-label">上傳歷史數據 (CSV)</label>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <button id="upload-btn" class="btn btn-secondary">
                        <i class="fas fa-upload"></i>選擇檔案
                    </button>
                    <span id="file-status" style="color: #6b7280; font-size: 0.875rem;">支援格式：日期,營收,流量,轉換率,客單價</span>
                </div>
                <input type="file" id="file-input" class="hidden" accept=".csv">
            </div>
            
            <div id="data-preview" class="hidden">
                <h3 style="font-weight: 600; margin-bottom: 1rem;">數據概覽</h3>
                <div class="grid-4">
                    <div class="metric-card">
                        <div id="total-revenue" class="metric-value">-</div>
                        <div class="metric-label">總營收</div>
                    </div>
                    <div class="metric-card">
                        <div id="avg-traffic" class="metric-value">-</div>
                        <div class="metric-label">平均月流量</div>
                    </div>
                    <div class="metric-card">
                        <div id="avg-cvr" class="metric-value">-</div>
                        <div class="metric-label">平均轉換率</div>
                    </div>
                    <div class="metric-card">
                        <div id="avg-aov" class="metric-value">-</div>
                        <div class="metric-label">平均客單價</div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: right; margin-top: 2rem;">
                <button id="next-1" class="btn btn-primary">
                    下一步：設定目標 <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Step 2: 目標設定 -->
        <div id="step-2" class="step-card hidden">
            <div class="step-header">
                <div class="step-number">2</div>
                <div>
                    <h2 class="step-title">智能目標設定</h2>
                    <p class="step-subtitle">基於歷史數據，設定合理且具挑戰性的目標</p>
                </div>
            </div>
            
            <div class="grid-2">
                <div class="input-group">
                    <label class="input-label">規劃期間 (月份)</label>
                    <input type="month" id="target-month" class="input-field">
                </div>
                <div class="input-group">
                    <label class="input-label">成長目標</label>
                    <select id="growth-target" class="input-field">
                        <option value="conservative">保守成長 (+10-20%)</option>
                        <option value="moderate" selected>穩健成長 (+20-40%)</option>
                        <option value="aggressive">積極成長 (+40-60%)</option>
                        <option value="custom">自訂目標</option>
                    </select>
                </div>
            </div>
            
            <div id="ai-suggestion" class="insight-card">
                <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                    <i class="fas fa-robot" style="color: #0ea5e9; margin-right: 0.5rem;"></i>
                    <strong>AI 智能建議</strong>
                </div>
                <p id="suggestion-text">根據您的歷史數據分析，建議設定穩健成長目標...</p>
            </div>
            
            <div class="grid-4">
                <div class="input-group">
                    <label class="input-label">目標營收</label>
                    <input type="number" id="target-revenue" class="input-field" placeholder="1,000,000">
                </div>
                <div class="input-group">
                    <label class="input-label">目標流量</label>
                    <input type="number" id="target-traffic" class="input-field" placeholder="自動計算">
                </div>
                <div class="input-group">
                    <label class="input-label">目標轉換率 (%)</label>
                    <input type="number" id="target-cvr" class="input-field" placeholder="自動計算" step="0.1">
                </div>
                <div class="input-group">
                    <label class="input-label">目標客單價</label>
                    <input type="number" id="target-aov" class="input-field" placeholder="自動計算">
                </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-top: 2rem;">
                <button id="back-2" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> 上一步
                </button>
                <button id="next-2" class="btn btn-primary">
                    下一步：缺口分析 <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Step 3: 缺口分析 -->
        <div id="step-3" class="step-card hidden">
            <div class="step-header">
                <div class="step-number">3</div>
                <div>
                    <h2 class="step-title">缺口分析與診斷</h2>
                    <p class="step-subtitle">識別關鍵改善點，找出增長機會</p>
                </div>
            </div>
            
            <div id="gap-analysis">
                <div class="grid-3">
                    <div id="traffic-gap" class="metric-card">
                        <div class="metric-value" style="color: #3b82f6;">+0</div>
                        <div class="metric-label">流量缺口</div>
                        <div style="margin-top: 0.5rem; font-size: 0.75rem; color: #6b7280;">需要增加的訪客數</div>
                    </div>
                    <div id="cvr-gap" class="metric-card">
                        <div class="metric-value" style="color: #10b981;">+0%</div>
                        <div class="metric-label">轉換率缺口</div>
                        <div style="margin-top: 0.5rem; font-size: 0.75rem; color: #6b7280;">需要提升的轉換率</div>
                    </div>
                    <div id="aov-gap" class="metric-card">
                        <div class="metric-value" style="color: #f59e0b;">+$0</div>
                        <div class="metric-label">客單價缺口</div>
                        <div style="margin-top: 0.5rem; font-size: 0.75rem; color: #6b7280;">需要提升的客單價</div>
                    </div>
                </div>
            </div>
            
            <div id="priority-analysis" class="insight-card" style="margin-top: 2rem;">
                <h3 style="font-weight: 600; margin-bottom: 1rem;">
                    <i class="fas fa-target" style="color: #0ea5e9; margin-right: 0.5rem;"></i>
                    優先改善建議
                </h3>
                <div id="priority-list">
                    <!-- 動態生成優先級建議 -->
                </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-top: 2rem;">
                <button id="back-3" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> 上一步
                </button>
                <button id="next-3" class="btn btn-primary">
                    下一步：活動規劃 <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Step 4: 活動規劃 -->
        <div id="step-4" class="step-card hidden">
            <div class="step-header">
                <div class="step-number">4</div>
                <div>
                    <h2 class="step-title">精準活動規劃</h2>
                    <p class="step-subtitle">基於缺口分析，推薦最適合的活動組合</p>
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <button id="generate-campaigns" class="btn btn-primary">
                    <i class="fas fa-magic"></i> 生成活動方案
                </button>
            </div>
            
            <div id="campaigns-container" class="grid-2">
                <!-- 動態生成活動卡片 -->
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-top: 2rem;">
                <button id="back-4" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> 上一步
                </button>
                <button id="next-4" class="btn btn-primary">
                    下一步：執行計畫 <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Step 5: 執行計畫 -->
        <div id="step-5" class="step-card hidden">
            <div class="step-header">
                <div class="step-number">5</div>
                <div>
                    <h2 class="step-title">執行計畫與追蹤</h2>
                    <p class="step-subtitle">制定具體的執行時程與追蹤指標</p>
                </div>
            </div>
            
            <div id="execution-plan">
                <!-- 動態生成執行計畫 -->
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-top: 2rem;">
                <button id="back-5" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> 上一步
                </button>
                <button id="export-plan" class="btn btn-primary">
                    <i class="fas fa-download"></i> 匯出完整計畫
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div style="display: flex; align-items: center;">
            <i id="toast-icon" class="fas fa-check-circle" style="color: var(--success); margin-right: 0.5rem;"></i>
            <span id="toast-message"></span>
        </div>
    </div>

    <script>
        class EcommerceGrowthPlanner {
            constructor() {
                this.currentStep = 1;
                this.data = {
                    brand: '',
                    category: '',
                    historical: [],
                    targets: {},
                    gaps: {},
                    campaigns: [],
                    timeline: []
                };
                this.init();
            }

            init() {
                this.bindEvents();
                this.setDefaultMonth();
            }

            bindEvents() {
                // File upload
                document.getElementById('upload-btn').onclick = () => document.getElementById('file-input').click();
                document.getElementById('file-input').onchange = (e) => this.handleFileUpload(e);
                
                // Navigation
                document.getElementById('next-1').onclick = () => this.nextStep();
                document.getElementById('next-2').onclick = () => this.nextStep();
                document.getElementById('next-3').onclick = () => this.nextStep();
                document.getElementById('next-4').onclick = () => this.nextStep();
                
                document.getElementById('back-2').onclick = () => this.prevStep();
                document.getElementById('back-3').onclick = () => this.prevStep();
                document.getElementById('back-4').onclick = () => this.prevStep();
                document.getElementById('back-5').onclick = () => this.prevStep();
                
                // Target calculation
                document.getElementById('growth-target').onchange = () => this.calculateTargets();
                document.getElementById('target-revenue').oninput = () => this.calculateFactors();
                
                // Campaign generation
                document.getElementById('generate-campaigns').onclick = () => this.generateCampaigns();
                
                // Export
                document.getElementById('export-plan').onclick = () => this.exportPlan();
            }

            setDefaultMonth() {
                const next = new Date();
                next.setMonth(next.getMonth() + 1);
                document.getElementById('target-month').value = next.toISOString().slice(0, 7);
            }

            handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const csv = e.target.result;
                        const lines = csv.split('\n').filter(line => line.trim());
                        
                        const data = lines.slice(1).map(line => {
                            const [date, revenue, traffic, cvr, aov] = line.split(',');
                            return {
                                date: new Date(date.trim()),
                                revenue: parseFloat(revenue) || 0,
                                traffic: parseFloat(traffic) || 0,
                                cvr: parseFloat(cvr) || 0,
                                aov: parseFloat(aov) || 0
                            };
                        }).filter(d => !isNaN(d.date.getTime()) && d.revenue > 0);

                        this.data.historical = data;
                        this.updateDataPreview();
                        this.showToast('數據上傳成功！');
                        
                    } catch (error) {
                        this.showToast('檔案格式錯誤，請檢查CSV格式', 'error');
                    }
                };
                reader.readAsText(file);
            }

            updateDataPreview() {
                const data = this.data.historical;
                if (data.length === 0) return;

                const totalRevenue = data.reduce((sum, d) => sum + d.revenue, 0);
                const avgTraffic = data.reduce((sum, d) => sum + d.traffic, 0) / data.length;
                const avgCvr = data.reduce((sum, d) => sum + d.cvr, 0) / data.length;
                const avgAov = data.reduce((sum, d) => sum + d.aov, 0) / data.length;

                document.getElementById('total-revenue').textContent = `$${totalRevenue.toLocaleString()}`;
                document.getElementById('avg-traffic').textContent = Math.round(avgTraffic).toLocaleString();
                document.getElementById('avg-cvr').textContent = `${avgCvr.toFixed(2)}%`;
                document.getElementById('avg-aov').textContent = `$${Math.round(avgAov).toLocaleString()}`;

                document.getElementById('data-preview').classList.remove('hidden');
            }

            calculateTargets() {
                const growthType = document.getElementById('growth-target').value;
                const historical = this.data.historical;
                
                if (historical.length === 0) return;

                const lastMonthRevenue = historical[historical.length - 1]?.revenue || 0;
                const avgRevenue = historical.reduce((sum, d) => sum + d.revenue, 0) / historical.length;
                const baseRevenue = Math.max(lastMonthRevenue, avgRevenue);

                let growthRate = 0.3; // default 30%
                switch (growthType) {
                    case 'conservative': growthRate = 0.15; break;
                    case 'moderate': growthRate = 0.3; break;
                    case 'aggressive': growthRate = 0.5; break;
                }

                const targetRevenue = Math.round(baseRevenue * (1 + growthRate));
                document.getElementById('target-revenue').value = targetRevenue;

                // AI suggestion
                document.getElementById('suggestion-text').textContent = 
                    `基於您過去${historical.length}個月的數據分析，平均月營收為$${Math.round(avgRevenue).toLocaleString()}，建議設定${(growthRate*100).toFixed(0)}%的成長目標，即$${targetRevenue.toLocaleString()}。這個目標具有挑戰性但可達成。`;

                this.calculateFactors();
            }

            calculateFactors() {
                const targetRevenue = parseFloat(document.getElementById('target-revenue').value) || 0;
                if (targetRevenue === 0) return;

                const historical = this.data.historical;
                const avgCvr = historical.reduce((sum, d) => sum + d.cvr, 0) / historical.length || 1.5;
                const avgAov = historical.reduce((sum, d) => sum + d.aov, 0) / historical.length || 2000;

                const targetTraffic = Math.ceil(targetRevenue / ((avgCvr / 100) * avgAov));
                
                document.getElementById('target-traffic').value = targetTraffic;
                document.getElementById('target-cvr').value = avgCvr.toFixed(2);
                document.getElementById('target-aov').value = Math.round(avgAov);

                this.data.targets = {
                    revenue: targetRevenue,
                    traffic: targetTraffic,
                    cvr: avgCvr,
                    aov: avgAov
                };
            }

            calculateGaps() {
                const historical = this.data.historical;
                const targets = this.data.targets;
                
                if (historical.length === 0 || !targets.revenue) return;

                const currentTraffic = historical.reduce((sum, d) => sum + d.traffic, 0) / historical.length;
                const currentCvr = historical.reduce((sum, d) => sum + d.cvr, 0) / historical.length;
                const currentAov = historical.reduce((sum, d) => sum + d.aov, 0) / historical.length;

                const gaps = {
                    traffic: Math.max(0, targets.traffic - currentTraffic),
                    cvr: Math.max(0, targets.cvr - currentCvr),
                    aov: Math.max(0, targets.aov - currentAov)
                };

                this.data.gaps = gaps;

                // Update UI
                document.querySelector('#traffic-gap .metric-value').textContent = `+${Math.round(gaps.traffic).toLocaleString()}`;
                document.querySelector('#cvr-gap .metric-value').textContent = `+${gaps.cvr.toFixed(2)}%`;
                document.querySelector('#aov-gap .metric-value').textContent = `+$${Math.round(gaps.aov).toLocaleString()}`;

                this.generatePriorityAnalysis(gaps);
            }

            generatePriorityAnalysis(gaps) {
                const priorities = [
                    { type: 'traffic', gap: gaps.traffic, impact: 'high', difficulty: 'medium' },
                    { type: 'cvr', gap: gaps.cvr, impact: 'high', difficulty: 'low' },
                    { type: 'aov', gap: gaps.aov, impact: 'medium', difficulty: 'low' }
                ].sort((a, b) => b.gap - a.gap);

                const priorityList = document.getElementById('priority-list');
                priorityList.innerHTML = priorities.map((p, i) => `
                    <div style="display: flex; align-items: center; margin-bottom: 1rem; padding: 1rem; background: white; border-radius: 12px; border: 1px solid #e5e7eb;">
                        <div style="width: 32px; height: 32px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin-right: 1rem;">
                            ${i + 1}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--gray-900);">
                                ${p.type === 'traffic' ? '流量提升' : p.type === 'cvr' ? '轉換率優化' : '客單價提升'}
                            </div>
                            <div style="font-size: 0.875rem; color: #6b7280;">
                                缺口：${p.type === 'traffic' ? Math.round(p.gap).toLocaleString() + ' 訪客' : 
                                       p.type === 'cvr' ? p.gap.toFixed(2) + '%' : 
                                       '$' + Math.round(p.gap).toLocaleString()}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 0.75rem; color: #10b981; font-weight: 600;">影響度: ${p.impact === 'high' ? '高' : '中'}</div>
                            <div style="font-size: 0.75rem; color: #f59e0b; font-weight: 600;">難度: ${p.difficulty === 'low' ? '低' : '中'}</div>
                        </div>
                    </div>
                `).join('');
            }

            generateCampaigns() {
                const gaps = this.data.gaps;
                const campaigns = [
                    {
                        name: 'Google Ads 精準投放',
                        type: 'traffic',
                        description: '針對高轉換關鍵字投放廣告',
                        impact: '流量提升 40-60%',
                        budget: '月預算 $50,000-100,000',
                        timeline: '1-2週見效'
                    },
                    {
                        name: 'KOL 合作推廣',
                        type: 'traffic',
                        description: '與相關領域 KOL 合作開箱推薦',
                        impact: '流量提升 30-50%',
                        budget: '單次合作 $20,000-50,000',
                        timeline: '2-4週見效'
                    },
                    {
                        name: '新客首購優惠',
                        type: 'cvr',
                        description: '首次購買享 85 折優惠',
                        impact: '轉換率提升 20-35%',
                        budget: '營收成本 15%',
                        timeline: '立即見效'
                    },
                    {
                        name: '限時免運活動',
                        type: 'cvr',
                        description: '全站免運費，降低購買門檻',
                        impact: '轉換率提升 15-25%',
                        budget: '運費成本承擔',
                        timeline: '立即見效'
                    },
                    {
                        name: '滿額贈品活動',
                        type: 'aov',
                        description: '消費滿 $2,500 贈送精美禮品',
                        impact: '客單價提升 25-40%',
                        budget: '贈品成本 + 營收 10%',
                        timeline: '1週見效'
                    },
                    {
                        name: '組合商品優惠',
                        type: 'aov',
                        description: '推出超值組合包，單買更划算',
                        impact: '客單價提升 30-50%',
                        budget: '營收成本 12%',
                        timeline: '2週見效'
                    }
                ];

                // 根據缺口排序推薦
                const sortedCampaigns = campaigns.sort((a, b) => {
                    const aGap = gaps[a.type] || 0;
                    const bGap = gaps[b.type] || 0;
                    return bGap - aGap;
                });

                const container = document.getElementById('campaigns-container');
                container.innerHTML = sortedCampaigns.map(campaign => `
                    <div class="campaign-card" onclick="this.classList.toggle('selected')">
                        <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 1rem;">
                            <h3 style="font-weight: 600; color: var(--gray-900); margin: 0; flex: 1;">${campaign.name}</h3>
                            <span style="background: ${campaign.type === 'traffic' ? '#dbeafe' : campaign.type === 'cvr' ? '#d1fae5' : '#fef3c7'}; 
                                         color: ${campaign.type === 'traffic' ? '#1e40af' : campaign.type === 'cvr' ? '#065f46' : '#92400e'}; 
                                         padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;">
                                ${campaign.type === 'traffic' ? '流量型' : campaign.type === 'cvr' ? '轉換型' : '客單價型'}
                            </span>
                        </div>
                        <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem;">${campaign.description}</p>
                        <div style="font-size: 0.75rem; color: #374151; line-height: 1.5;">
                            <div><strong>預期效果：</strong>${campaign.impact}</div>
                            <div><strong>預算需求：</strong>${campaign.budget}</div>
                            <div><strong>見效時間：</strong>${campaign.timeline}</div>
                        </div>
                    </div>
                `).join('');

                this.data.campaigns = sortedCampaigns;
            }

            nextStep() {
                // Validation
                if (this.currentStep === 1) {
                    if (!document.getElementById('brand-name').value) {
                        this.showToast('請輸入品牌名稱', 'error');
                        return;
                    }
                    this.data.brand = document.getElementById('brand-name').value;
                    this.data.category = document.getElementById('category').value;
                }

                if (this.currentStep === 2) {
                    this.calculateTargets();
                    if (!this.data.targets.revenue) {
                        this.showToast('請設定目標營收', 'error');
                        return;
                    }
                }

                if (this.currentStep === 3) {
                    this.calculateGaps();
                }

                this.currentStep++;
                this.updateStepDisplay();
                this.updateProgress();
            }

            prevStep() {
                this.currentStep--;
                this.updateStepDisplay();
                this.updateProgress();
            }

            updateStepDisplay() {
                for (let i = 1; i <= 5; i++) {
                    const step = document.getElementById(`step-${i}`);
                    if (i === this.currentStep) {
                        step.classList.remove('hidden');
                    } else {
                        step.classList.add('hidden');
                    }
                }
            }

            updateProgress() {
                const progress = (this.currentStep / 5) * 100;
                document.getElementById('progress').style.width = `${progress}%`;
            }

            exportPlan() {
                const selectedCampaigns = Array.from(document.querySelectorAll('.campaign-card.selected'))
                    .map(card => card.querySelector('h3').textContent);

                const plan = {
                    brand: this.data.brand,
                    category: this.data.category,
                    targetMonth: document.getElementById('target-month').value,
                    targets: this.data.targets,
                    gaps: this.data.gaps,
                    selectedCampaigns: selectedCampaigns,
                    exportDate: new Date().toISOString()
                };

                const blob = new Blob([JSON.stringify(plan, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${this.data.brand}-growth-plan-${new Date().toISOString().slice(0, 10)}.json`;
                a.click();
                URL.revokeObjectURL(url);

                this.showToast('成長計畫已匯出！');
            }

            showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                const icon = document.getElementById('toast-icon');
                const messageEl = document.getElementById('toast-message');

                messageEl.textContent = message;
                
                if (type === 'error') {
                    icon.className = 'fas fa-exclamation-triangle';
                    icon.style.color = 'var(--danger)';
                    toast.style.borderLeftColor = 'var(--danger)';
                } else {
                    icon.className = 'fas fa-check-circle';
                    icon.style.color = 'var(--success)';
                    toast.style.borderLeftColor = 'var(--success)';
                }

                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            new EcommerceGrowthPlanner();
        });
    </script>
</body>
</html>