<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電商目標檢核與活動規劃器 - 優化版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .glass { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.9); border: 1px solid rgba(255, 255, 255, 0.2); }
        .card { @apply glass p-6 rounded-2xl shadow-xl transition-all duration-300; }
        .card:hover { @apply shadow-2xl transform -translate-y-1; }
        .form-input { @apply mt-2 block w-full px-4 py-3 bg-white/80 border border-gray-200 rounded-xl shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all; }
        .btn { @apply px-6 py-3 rounded-xl font-semibold text-sm shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 transition-all transform hover:scale-105; }
        .btn-primary { @apply bg-gradient-to-r from-indigo-600 to-purple-600 text-white hover:from-indigo-700 hover:to-purple-700; }
        .btn-ai { @apply bg-gradient-to-r from-violet-500 to-purple-600 text-white hover:from-violet-600 hover:to-purple-700; }
        .metric-card { @apply bg-gradient-to-br from-white to-gray-50 p-6 rounded-xl shadow-lg border border-gray-100; }
        .progress-bar { @apply w-full bg-gray-200 rounded-full h-2; }
        .progress-fill { @apply h-2 rounded-full transition-all duration-500; }
        .toast { position: fixed; top: 1rem; right: 1rem; z-index: 50; opacity: 0; transform: translateX(100%); transition: all 0.3s ease-out; }
        .toast.show { opacity: 1; transform: translateX(0); }
        .loader { width: 1rem; height: 1rem; border: 2px solid currentColor; border-right-color: transparent; border-radius: 50%; animation: spin .75s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .campaign-card { @apply bg-white/90 backdrop-blur-sm border border-white/20 rounded-xl p-5 shadow-lg hover:shadow-xl transition-all duration-300; }
        .factor-badge { @apply inline-flex items-center px-3 py-1 rounded-full text-xs font-bold; }
        .factor-t { @apply bg-blue-100 text-blue-800; }
        .factor-c { @apply bg-green-100 text-green-800; }
        .factor-a { @apply bg-orange-100 text-orange-800; }
    </style>
</head>
<body class="p-4">
    <div class="max-w-7xl mx-auto space-y-6">
        <!-- Header -->
        <header class="card">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                <div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">電商目標檢核與活動規劃器</h1>
                    <p class="text-gray-600 mt-2">智能化目標設定與活動規劃，讓您的電商業績更上一層樓</p>
                </div>
                <div class="flex flex-wrap gap-3">
                    <button id="import-btn" class="btn bg-white text-gray-700 border border-gray-300 hover:bg-gray-50">
                        <i class="fas fa-upload mr-2"></i>匯入數據
                    </button>
                    <button id="export-btn" class="btn btn-primary">
                        <i class="fas fa-download mr-2"></i>匯出規劃
                    </button>
                    <input type="file" id="file-input" class="hidden" accept=".csv,.txt,.tsv">
                </div>
            </div>
        </header>

        <!-- Data Summary -->
        <div id="data-summary" class="card hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-chart-line mr-2 text-indigo-500"></i>數據概覽
            </h2>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="metric-card text-center">
                    <p class="text-sm text-gray-500">總營收</p>
                    <p id="total-revenue" class="text-2xl font-bold text-gray-800">-</p>
                </div>
                <div class="metric-card text-center">
                    <p class="text-sm text-gray-500">平均客單價</p>
                    <p id="avg-aov" class="text-2xl font-bold text-gray-800">-</p>
                </div>
                <div class="metric-card text-center">
                    <p class="text-sm text-gray-500">平均轉換率</p>
                    <p id="avg-cvr" class="text-2xl font-bold text-gray-800">-</p>
                </div>
                <div class="metric-card text-center">
                    <p class="text-sm text-gray-500">平均流量</p>
                    <p id="avg-traffic" class="text-2xl font-bold text-gray-800">-</p>
                </div>
            </div>
        </div>

        <!-- Goal Setting -->
        <div class="card">
            <h2 class="text-xl font-bold text-gray-800 mb-6">目標設定</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">品牌名稱</label>
                    <input type="text" id="brand-name" class="form-input" placeholder="輸入品牌名稱">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">開始日期</label>
                    <input type="date" id="start-date" class="form-input">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">結束日期</label>
                    <input type="date" id="end-date" class="form-input">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">北極星指標</label>
                    <select id="north-star" class="form-input">
                        <option>提升總體營收</option>
                        <option>提高回購率</option>
                        <option>新客轉換率</option>
                        <option>客單價提升</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Three Factors Analysis -->
        <div class="card">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">三因子分析 (T × C × A = R)</h2>
                <button id="ai-suggest-btn" class="btn btn-ai hidden">
                    <i class="fas fa-robot mr-2"></i>AI 智能建議
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">目標營收 (R)</label>
                    <input type="number" id="revenue-goal" class="form-input" placeholder="1,000,000">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">流量 (T)</label>
                    <input type="number" id="traffic" class="form-input" placeholder="自動計算">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">轉換率 (C) %</label>
                    <input type="number" id="conversion-rate" class="form-input" placeholder="自動計算" step="0.01">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">客單價 (A)</label>
                    <input type="number" id="aov" class="form-input" placeholder="自動計算">
                </div>
            </div>

            <!-- Results Display -->
            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="text-center">
                        <p class="text-sm text-gray-600">計算營收</p>
                        <p id="calculated-revenue" class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">-</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-600">目標達成度</p>
                        <div id="goal-progress" class="mt-2">
                            <div class="progress-bar">
                                <div id="progress-fill" class="progress-fill bg-gradient-to-r from-green-400 to-blue-500" style="width: 0%"></div>
                            </div>
                            <p id="progress-text" class="text-sm text-gray-600 mt-1">0%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gap Analysis -->
            <div id="gap-analysis" class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6 hidden">
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                    <div class="flex items-center text-blue-800 mb-2">
                        <i class="fas fa-users mr-2"></i>
                        <span class="font-semibold">流量缺口</span>
                    </div>
                    <p id="traffic-gap" class="text-lg font-bold text-blue-900">-</p>
                </div>
                <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                    <div class="flex items-center text-green-800 mb-2">
                        <i class="fas fa-mouse-pointer mr-2"></i>
                        <span class="font-semibold">轉換率缺口</span>
                    </div>
                    <p id="cvr-gap" class="text-lg font-bold text-green-900">-</p>
                </div>
                <div class="bg-orange-50 p-4 rounded-xl border border-orange-200">
                    <div class="flex items-center text-orange-800 mb-2">
                        <i class="fas fa-dollar-sign mr-2"></i>
                        <span class="font-semibold">客單價缺口</span>
                    </div>
                    <p id="aov-gap" class="text-lg font-bold text-orange-900">-</p>
                </div>
            </div>
        </div>

        <!-- Campaign Generator -->
        <div class="card">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-gray-800">AI 活動規劃</h2>
                    <p class="text-sm text-gray-600">根據缺口分析，智能推薦最適合的活動方案</p>
                </div>
                <button id="generate-campaigns" class="btn btn-primary">
                    <i class="fas fa-magic mr-2"></i>生成活動方案
                </button>
            </div>
            <div id="campaigns-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Campaigns will be generated here -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast p-4 rounded-xl shadow-lg max-w-sm">
        <div class="flex items-center">
            <i id="toast-icon" class="fas fa-check-circle text-green-500 mr-3"></i>
            <span id="toast-message" class="text-sm font-medium"></span>
        </div>
    </div>

    <script>
        class EcommercePlanner {
            constructor() {
                this.historicalData = [];
                this.initializeElements();
                this.bindEvents();
                this.setDefaultDates();
            }

            initializeElements() {
                this.elements = {
                    // Inputs
                    brandName: document.getElementById('brand-name'),
                    startDate: document.getElementById('start-date'),
                    endDate: document.getElementById('end-date'),
                    northStar: document.getElementById('north-star'),
                    revenueGoal: document.getElementById('revenue-goal'),
                    traffic: document.getElementById('traffic'),
                    conversionRate: document.getElementById('conversion-rate'),
                    aov: document.getElementById('aov'),
                    
                    // Displays
                    calculatedRevenue: document.getElementById('calculated-revenue'),
                    progressFill: document.getElementById('progress-fill'),
                    progressText: document.getElementById('progress-text'),
                    gapAnalysis: document.getElementById('gap-analysis'),
                    trafficGap: document.getElementById('traffic-gap'),
                    cvrGap: document.getElementById('cvr-gap'),
                    aovGap: document.getElementById('aov-gap'),
                    campaignsContainer: document.getElementById('campaigns-container'),
                    
                    // Summary
                    dataSummary: document.getElementById('data-summary'),
                    totalRevenue: document.getElementById('total-revenue'),
                    avgAov: document.getElementById('avg-aov'),
                    avgCvr: document.getElementById('avg-cvr'),
                    avgTraffic: document.getElementById('avg-traffic'),
                    
                    // Buttons
                    importBtn: document.getElementById('import-btn'),
                    exportBtn: document.getElementById('export-btn'),
                    fileInput: document.getElementById('file-input'),
                    aiSuggestBtn: document.getElementById('ai-suggest-btn'),
                    generateCampaigns: document.getElementById('generate-campaigns'),
                    
                    // Toast
                    toast: document.getElementById('toast'),
                    toastIcon: document.getElementById('toast-icon'),
                    toastMessage: document.getElementById('toast-message')
                };
            }

            bindEvents() {
                // Factor inputs
                [this.elements.revenueGoal, this.elements.traffic, this.elements.conversionRate, this.elements.aov]
                    .forEach(input => {
                        input.addEventListener('input', () => this.calculateFactors());
                        input.addEventListener('focus', () => input.classList.remove('ai-filled'));
                    });

                // Buttons
                this.elements.importBtn.addEventListener('click', () => this.elements.fileInput.click());
                this.elements.fileInput.addEventListener('change', (e) => this.importData(e));
                this.elements.exportBtn.addEventListener('click', () => this.exportData());
                this.elements.aiSuggestBtn.addEventListener('click', () => this.aiSuggestFactors());
                this.elements.generateCampaigns.addEventListener('click', () => this.generateCampaigns());
            }

            setDefaultDates() {
                const today = new Date();
                const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
                const endOfNextMonth = new Date(today.getFullYear(), today.getMonth() + 2, 0);
                
                this.elements.startDate.value = nextMonth.toISOString().split('T')[0];
                this.elements.endDate.value = endOfNextMonth.toISOString().split('T')[0];
            }

            calculateFactors() {
                const R = parseFloat(this.elements.revenueGoal.value) || 0;
                const T = parseFloat(this.elements.traffic.value) || 0;
                const C = parseFloat(this.elements.conversionRate.value) || 0;
                const A = parseFloat(this.elements.aov.value) || 0;

                if (R === 0) {
                    this.resetCalculations();
                    return;
                }

                const filledCount = [T, C, A].filter(v => v > 0).length;

                if (filledCount === 0) {
                    this.elements.aiSuggestBtn.classList.remove('hidden');
                    this.resetCalculations();
                } else if (filledCount === 2) {
                    this.autoCalculateMissingFactor(R, T, C, A);
                } else if (filledCount === 3) {
                    this.validateAndDisplay(R, T, C, A);
                }
            }

            autoCalculateMissingFactor(R, T, C, A) {
                if (T === 0) {
                    const calculatedT = R / ((C / 100) * A);
                    this.fillInput(this.elements.traffic, Math.ceil(calculatedT));
                    T = calculatedT;
                } else if (C === 0) {
                    const calculatedC = (R / (T * A)) * 100;
                    this.fillInput(this.elements.conversionRate, calculatedC.toFixed(2));
                    C = calculatedC;
                } else if (A === 0) {
                    const calculatedA = R / (T * (C / 100));
                    this.fillInput(this.elements.aov, Math.ceil(calculatedA));
                    A = calculatedA;
                }
                
                this.validateAndDisplay(R, T, C, A);
            }

            validateAndDisplay(R, T, C, A) {
                const calculatedR = T * (C / 100) * A;
                this.elements.calculatedRevenue.textContent = `$${calculatedR.toLocaleString()}`;
                
                const progress = Math.min((calculatedR / R) * 100, 100);
                this.elements.progressFill.style.width = `${progress}%`;
                this.elements.progressText.textContent = `${progress.toFixed(1)}%`;
                
                if (calculatedR < R * 0.95) {
                    this.showGapAnalysis(R, T, C / 100, A);
                } else {
                    this.elements.gapAnalysis.classList.add('hidden');
                }
            }

            showGapAnalysis(R, T, C, A) {
                this.elements.gapAnalysis.classList.remove('hidden');
                
                const neededT = (R / (C * A)) - T;
                const neededC = ((R / (T * A)) - C) * 100;
                const neededA = (R / (T * C)) - A;
                
                this.elements.trafficGap.textContent = neededT > 0 ? `+${Math.ceil(neededT).toLocaleString()}` : '已達標';
                this.elements.cvrGap.textContent = neededC > 0 ? `+${neededC.toFixed(2)}%` : '已達標';
                this.elements.aovGap.textContent = neededA > 0 ? `+$${Math.ceil(neededA).toLocaleString()}` : '已達標';
            }

            resetCalculations() {
                this.elements.calculatedRevenue.textContent = '-';
                this.elements.progressFill.style.width = '0%';
                this.elements.progressText.textContent = '0%';
                this.elements.gapAnalysis.classList.add('hidden');
            }

            fillInput(element, value) {
                element.value = value;
                element.classList.add('ai-filled');
            }

            async aiSuggestFactors() {
                const R = parseFloat(this.elements.revenueGoal.value) || 0;
                if (R === 0) {
                    this.showToast('請先輸入目標營收', 'error');
                    return;
                }

                this.elements.aiSuggestBtn.innerHTML = '<span class="loader mr-2"></span>AI 分析中...';
                this.elements.aiSuggestBtn.disabled = true;

                // Simulate AI processing
                await new Promise(resolve => setTimeout(resolve, 1500));

                let suggestedCVR = 1.5;
                let suggestedAOV = 2000;

                // Use historical data if available
                if (this.historicalData.length > 0) {
                    const validCVR = this.historicalData.filter(d => d.cvr > 0);
                    const validAOV = this.historicalData.filter(d => d.aov > 0);
                    
                    if (validCVR.length > 0) {
                        suggestedCVR = validCVR.reduce((sum, d) => sum + d.cvr, 0) / validCVR.length;
                    }
                    if (validAOV.length > 0) {
                        suggestedAOV = validAOV.reduce((sum, d) => sum + d.aov, 0) / validAOV.length;
                    }
                }

                const suggestedTraffic = R / (suggestedAOV * (suggestedCVR / 100));

                this.fillInput(this.elements.traffic, Math.ceil(suggestedTraffic));
                this.fillInput(this.elements.conversionRate, suggestedCVR.toFixed(2));
                this.fillInput(this.elements.aov, Math.ceil(suggestedAOV));

                this.elements.aiSuggestBtn.innerHTML = '<i class="fas fa-robot mr-2"></i>AI 智能建議';
                this.elements.aiSuggestBtn.disabled = false;
                this.elements.aiSuggestBtn.classList.add('hidden');

                this.calculateFactors();
                this.showToast('AI 建議已套用', 'success');
            }

            generateCampaigns() {
                const campaigns = [
                    {
                        name: 'KOL 合作推廣',
                        type: '流量型',
                        factor: 'T',
                        description: '與知名 KOL 合作，快速擴大品牌曝光',
                        target: '新客群',
                        score: 92,
                        estimatedImpact: '流量提升 30-50%'
                    },
                    {
                        name: '新客首購優惠',
                        type: '轉換型',
                        factor: 'C',
                        description: '針對新訪客提供首購折扣',
                        target: '首次訪客',
                        score: 88,
                        estimatedImpact: '轉換率提升 15-25%'
                    },
                    {
                        name: '滿額贈品活動',
                        type: '客單價型',
                        factor: 'A',
                        description: '消費滿額即贈送精美贈品',
                        target: '現有客戶',
                        score: 85,
                        estimatedImpact: '客單價提升 20-35%'
                    },
                    {
                        name: 'Google Ads 投放',
                        type: '流量型',
                        factor: 'T',
                        description: '精準投放 Google 廣告',
                        target: '潛在客戶',
                        score: 90,
                        estimatedImpact: '流量提升 40-60%'
                    },
                    {
                        name: '限時免運活動',
                        type: '轉換型',
                        factor: 'C',
                        description: '限時免運費促銷',
                        target: '猶豫客戶',
                        score: 95,
                        estimatedImpact: '轉換率提升 20-30%'
                    },
                    {
                        name: '組合商品優惠',
                        type: '客單價型',
                        factor: 'A',
                        description: '推出超值組合包',
                        target: '回購客戶',
                        score: 87,
                        estimatedImpact: '客單價提升 25-40%'
                    }
                ];

                this.elements.campaignsContainer.innerHTML = campaigns.map(campaign => `
                    <div class="campaign-card">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center">
                                <span class="factor-badge factor-${campaign.factor.toLowerCase()}">${campaign.factor}</span>
                                <h3 class="font-bold text-gray-800 ml-2">${campaign.name}</h3>
                            </div>
                            <div class="text-right">
                                <div class="text-xl font-bold text-indigo-600">${campaign.score}</div>
                                <div class="text-xs text-gray-500">評分</div>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mb-3">${campaign.type}</p>
                        <div class="space-y-2 text-sm text-gray-600">
                            <p><strong>目標：</strong>${campaign.target}</p>
                            <p><strong>說明：</strong>${campaign.description}</p>
                            <p><strong>預期效果：</strong>${campaign.estimatedImpact}</p>
                        </div>
                        <div class="mt-4 pt-4 border-t">
                            <label class="block text-xs font-medium text-gray-600 mb-1">預期貢獻營收</label>
                            <input type="number" class="form-input !py-2 text-sm" placeholder="例如: 150,000">
                        </div>
                    </div>
                `).join('');

                this.showToast('活動方案已生成', 'success');
            }

            importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const csv = e.target.result;
                        const lines = csv.split('\n').filter(line => line.trim());
                        
                        if (lines.length < 2) {
                            this.showToast('CSV 檔案格式錯誤', 'error');
                            return;
                        }

                        const header = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        const data = lines.slice(1).map(line => {
                            const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                            return {
                                date: new Date(values[0]),
                                revenue: parseFloat(values[1]) || 0,
                                traffic: parseFloat(values[2]) || 0,
                                cvr: parseFloat(values[3]) || 0,
                                aov: parseFloat(values[4]) || 0
                            };
                        }).filter(d => !isNaN(d.date.getTime()) && d.revenue > 0);

                        this.historicalData = data;
                        this.updateSummary();
                        this.showToast(`成功匯入 ${data.length} 筆資料`, 'success');
                        
                    } catch (error) {
                        this.showToast('檔案解析失敗', 'error');
                    }
                };
                reader.readAsText(file);
            }

            updateSummary() {
                if (this.historicalData.length === 0) return;

                const totalRevenue = this.historicalData.reduce((sum, d) => sum + d.revenue, 0);
                const validAOV = this.historicalData.filter(d => d.aov > 0);
                const validCVR = this.historicalData.filter(d => d.cvr > 0);
                const validTraffic = this.historicalData.filter(d => d.traffic > 0);

                this.elements.totalRevenue.textContent = `$${totalRevenue.toLocaleString()}`;
                this.elements.avgAov.textContent = validAOV.length > 0 ? 
                    `$${Math.round(validAOV.reduce((sum, d) => sum + d.aov, 0) / validAOV.length).toLocaleString()}` : '-';
                this.elements.avgCvr.textContent = validCVR.length > 0 ? 
                    `${(validCVR.reduce((sum, d) => sum + d.cvr, 0) / validCVR.length).toFixed(2)}%` : '-';
                this.elements.avgTraffic.textContent = validTraffic.length > 0 ? 
                    Math.round(validTraffic.reduce((sum, d) => sum + d.traffic, 0) / validTraffic.length).toLocaleString() : '-';

                this.elements.dataSummary.classList.remove('hidden');
            }

            exportData() {
                const data = {
                    brand: this.elements.brandName.value,
                    period: {
                        start: this.elements.startDate.value,
                        end: this.elements.endDate.value
                    },
                    goals: {
                        revenue: parseFloat(this.elements.revenueGoal.value) || 0,
                        traffic: parseFloat(this.elements.traffic.value) || 0,
                        cvr: parseFloat(this.elements.conversionRate.value) || 0,
                        aov: parseFloat(this.elements.aov.value) || 0
                    },
                    campaigns: Array.from(this.elements.campaignsContainer.querySelectorAll('.campaign-card')).map(card => ({
                        name: card.querySelector('h3').textContent,
                        expectedRevenue: parseFloat(card.querySelector('input').value) || 0
                    })),
                    exportDate: new Date().toISOString()
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ecommerce-plan-${data.brand || 'export'}-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                this.showToast('規劃資料已匯出', 'success');
            }

            showToast(message, type = 'success') {
                this.elements.toastMessage.textContent = message;
                
                if (type === 'success') {
                    this.elements.toast.className = 'toast p-4 rounded-xl shadow-lg max-w-sm bg-green-50 border border-green-200';
                    this.elements.toastIcon.className = 'fas fa-check-circle text-green-500 mr-3';
                } else {
                    this.elements.toast.className = 'toast p-4 rounded-xl shadow-lg max-w-sm bg-red-50 border border-red-200';
                    this.elements.toastIcon.className = 'fas fa-exclamation-triangle text-red-500 mr-3';
                }

                this.elements.toast.classList.add('show');
                setTimeout(() => this.elements.toast.classList.remove('show'), 3000);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new EcommercePlanner();
        });
    </script>
</body>
</html>